<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sthalos — Full</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
  /* local font - make sure brevis.ttf is in same folder */
  @font-face {
    font-family: 'Brevia';
    src: url('brevis.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
    font-display: swap;
  }

  :root { --accent: #ff1a1a; --accent-dark: #000; }

  /* Base */
  * { box-sizing: border-box; }
  html,body { height:100%; margin:0; }
  body {
    font-family: Brevia, Arial, Helvetica, sans-serif;
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    text-align:center;
    min-height:100vh;
    overflow-x:hidden;
    background: linear-gradient(-45deg,#1a0033,#000033,#330000,#220033);
    background-size:400% 400%;
    animation: gradientShift 12s ease infinite;
    transition: background .6s ease, color .3s ease;
    color: var(--accent);
  }
  @keyframes gradientShift { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }

  /* Top-right icons */
  .top-right {
    position: fixed;
    top: 18px;
    right: 18px;
    display:flex;
    gap:12px;
    z-index:1100;
  }
  .circle-btn {
    width:44px; height:44px; border-radius:50%;
    display:inline-flex; align-items:center; justify-content:center;
    color:white; background:#444; text-decoration:none; cursor:pointer;
    box-shadow:0 6px 18px rgba(0,0,0,0.35);
    transition: transform .18s ease;
  }
  .circle-btn:hover { transform: scale(1.08); }
  .insta { background:#e1306c; }
  .google { background:#fff; color:#4285F4; font-weight:700; }
  .settings { background:#555; }

  /* Header / CTA */
  h1 { font-size:64px; margin:8px 0; color:var(--accent); line-height:1; font-family: 'Brevia', sans-serif; }
  .lead { font-size:20px; margin:6px 0 20px; color:var(--accent); }

  .btn-enter {
    background: var(--accent);
    color: var(--accent-dark);
    padding:14px 38px;
    border-radius:10px;
    font-size:20px;
    font-weight:700;
    border:none;
    cursor:pointer;
    box-shadow:0 12px 30px rgba(0,0,0,0.35);
    transition: transform .12s ease, box-shadow .2s ease;
  }
  .btn-enter:active { transform: scale(.98); }
  .btn-enter:hover { box-shadow:0 18px 42px rgba(0,0,0,0.45); }

  /* Quote */
  #quote {
    position: fixed;
    bottom: 34px;
    left: 50%;
    transform: translateX(-50%);
    max-width: 980px;
    padding: 0 18px;
    font-size:18px;
    color: var(--accent);
    z-index: 900;
    text-align:center;
  }

  /* Menu overlay (center modal) */
  #menuOverlay {
    position: fixed; inset:0;
    display:none; align-items:center; justify-content:center;
    background: rgba(0,0,0,0.56); backdrop-filter: blur(6px);
    z-index: 1000;
  }
  #menuBox {
    width:92%; max-width:420px; background: rgba(12,12,12,0.98);
    border-radius:14px; padding:26px; color:#fff; transform:scale(.96);
    opacity:0; transition: transform .28s ease, opacity .28s ease;
    box-shadow: 0 20px 60px rgba(0,0,0,0.6);
  }
  #menuOverlay.show #menuBox { transform:scale(1); opacity:1; }
  #menuBox h2 { font-size:20px; margin-bottom:14px; color:#fff; text-transform:uppercase; letter-spacing:1px; }
  .menu-feature { display:block; padding:12px; background:#222; color:#fff; border-radius:10px; text-decoration:none; font-weight:800; margin:8px 0; }
  .menu-close { margin-top:12px; background:transparent; color:#fff; border:1px solid #333; padding:8px 12px; border-radius:8px; cursor:pointer; }

  /* Settings side panel - hidden off-screen by -100% (fixes black strip) */
  #settingsPanel {
    position: fixed;
    top:0;
    right:-100%;
    width:320px;
    height:100%;
    background: #000;
    color:#fff;
    z-index: 1200;
    transition: right .36s cubic-bezier(.2,.9,.2,1);
    display:flex;
    flex-direction:column;
    padding:18px;
  }
  #settingsPanel.open { right:0; }
  #settingsPanel h3 { margin:6px 0 12px 0; font-size:20px; text-align:center; }
  .setting-item { background:#111; padding:10px; border-radius:8px; margin:8px 0; cursor:pointer; text-align:center; }
  .settings-footer { margin-top:auto; background:#0e0e0e; padding:12px; border-radius:8px; text-align:center; cursor:pointer; }

  /* Themes modal (center) */
  #themesModalOverlay {
    position:fixed; inset:0; display:none; align-items:center; justify-content:center;
    background: rgba(0,0,0,0.6); z-index:1400; backdrop-filter: blur(4px);
  }
  #themesModal {
    width:94%; max-width:820px; max-height:86vh; overflow-y:auto;
    background: rgba(8,8,8,0.98); border-radius:12px; padding:18px; color:#fff;
    box-shadow: 0 28px 80px rgba(0,0,0,0.7);
  }
  #themesModalHeader { display:flex; align-items:center; justify-content:space-between; gap:10px; }
  #themesModalHeader h3 { margin:0; font-size:18px; text-transform:uppercase; letter-spacing:1px; }

  #themesGrid {
    margin-top:12px;
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap:12px;
  }
  .theme-card {
    display:flex; gap:12px; align-items:center; padding:12px; border-radius:10px;
    background: rgba(255,255,255,0.03); cursor:pointer; transition: transform .12s ease, background .12s ease;
  }
  .theme-card:hover { transform: translateY(-4px); background: rgba(255,255,255,0.06); }
  .theme-dot { width:36px; height:36px; border-radius:50%; flex-shrink:0; border:2px solid rgba(255,255,255,0.06); box-shadow:0 6px 18px rgba(0,0,0,0.35); }
  .theme-name { font-size:15px; font-weight:800; color:#fff; }
  .theme-desc { font-size:12px; color:#ddd; opacity:.85; margin-top:4px; }

  #themesCloseBtn { margin-top:12px; display:block; margin-left:auto; margin-right:auto; padding:8px 14px; border-radius:8px; background:transparent; border:1px solid #333; color:#fff; cursor:pointer; }

  @media (max-width:900px) { #themesGrid { grid-template-columns: repeat(2,1fr); } }
  @media (max-width:520px) { #themesGrid { grid-template-columns: 1fr; } h1{font-size:36px} .btn-enter{padding:12px 26px;font-size:18px} }

  /* Generator UI */
  .gen-overlay { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.72); z-index:2000; }
  .gen-overlay.show { display:flex; }
  .gen-box { width:94%; max-width:520px; background: linear-gradient(180deg,#0b0b0b,#0f0f0f); color:#fff; padding:20px; border-radius:12px; box-shadow:0 24px 80px rgba(0,0,0,.7); transform:scale(.96); opacity:0; transition:all .28s ease; text-align:center; }
  .gen-overlay.show .gen-box { transform:scale(1); opacity:1; }

  .gen-header { font-size:18px; font-weight:800; color:var(--accent,#ff1a1a); margin-bottom:10px; letter-spacing:0.6px; }
  .gen-sub { color:#ddd; font-size:14px; margin-bottom:12px; }

  .option-grid { display:grid; gap:10px; margin-top:12px; grid-template-columns: repeat(3,1fr); }
  @media (max-width:640px){ .option-grid { grid-template-columns: repeat(2,1fr); } }
  @media (max-width:420px){ .option-grid { grid-template-columns: 1fr; } }

  .option-btn { background: rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.02); padding:10px 8px; border-radius:8px; cursor:pointer; color:#fff; font-weight:800; }
  .option-btn:hover { transform: translateY(-3px); }
  .option-btn.selected { outline: 2px solid rgba(255,255,255,0.06); background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); }

  .gen-actions { display:flex; gap:10px; justify-content:center; margin-top:14px; flex-wrap:wrap; }
  .back-small { background:#222; color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; }
  .next-primary { background:var(--accent,#ff1a1a); color:#000; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:900; }

  .gen-loading { display:flex; flex-direction:column; align-items:center; gap:12px; padding:14px; }
  .spinner { width:56px; height:56px; border-radius:50%; border:6px solid rgba(255,255,255,0.08); border-top-color:var(--accent,#ff1a1a); animation:gen-spin 1s linear infinite; }
  @keyframes gen-spin { to { transform: rotate(360deg); } }

  .gen-challenge { margin-top:12px; padding:14px; border-radius:10px; background: linear-gradient(180deg,#111,#161616); color:#fff; }
  .gen-challenge h3 { margin:6px 0 8px; font-size:18px; }
  .gen-challenge p { margin:0; color:#ddd; font-size:14px; }

  .gen-complete-card { width:94%; max-width:520px; background: linear-gradient(180deg,#061022,#071028); padding:18px; border-radius:12px; color:#fff; text-align:center; box-shadow:0 28px 80px rgba(0,0,0,0.7); position:relative; }
  .card-title { font-family: 'Brevia', Arial, sans-serif; font-size:22px; font-weight:900; color:var(--accent,#ff1a1a); letter-spacing:2px; margin-bottom:8px; }
  .card-image { height:140px; border-radius:8px; background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); display:flex; align-items:center; justify-content:center; color:rgba(255,255,255,0.12); margin-bottom:12px; }
  .card-details { color:#ddd; font-size:15px; line-height:1.4; }
  .card-meta { margin-top:10px; color:#c7d2e8; font-size:13px; opacity:.9; }

  .gen-watermark { position:absolute; right:12px; bottom:10px; color:rgba(255,255,255,0.18); font-weight:700; font-size:12px; }

  .gen-complete-actions { display:flex; gap:10px; justify-content:center; margin-top:14px; flex-wrap:wrap; }
  .gen-btn { padding:10px 14px; border-radius:8px; border:none; cursor:pointer; font-weight:800; }
  .gen-btn.primary { background:var(--accent,#ff1a1a); color:#000; }
  .gen-btn.light { background:#1b1b1b; color:#fff; border:1px solid rgba(255,255,255,0.04); }

  .share-btn { position:absolute; top:15px; right:15px; font-size:20px; color:white; cursor:pointer; transition:transform 0.2s ease; }
  .share-btn:hover { transform:scale(1.2); color:#ff4d4d; }

  /* small helper for focus outlines */
  .theme-card:focus { outline: 3px solid rgba(255,255,255,0.08); outline-offset:2px; }

  /* make sure generator open prevents body scroll */
  body.gen-active { overflow:hidden; }
</style>
</head>
<body class="theme-default">

  <!-- top icons -->
  <div class="top-right">
    <a class="circle-btn insta" href="https://instagram.com/train.with.harsh" target="_blank"><i class="fab fa-instagram"></i></a>
    <a class="circle-btn google" href="#"><i class="fab fa-google"></i></a>
    <div id="settingsBtn" class="circle-btn settings"><i class="fas fa-cog"></i></div>
  </div>

  <!-- landing -->
  <main style="padding:20px; text-align:center;">
    <h1 id="brand">Sthalos</h1>
    <div class="lead">Strength meets challenge. Coming soon.</div>
    <div style="height:8px;"></div>
    <button id="enterBtn" class="btn-enter" aria-label="Enter">ENTER</button>
  </main>

  <div id="quote" aria-live="polite"></div>

  <!-- menu -->
  <div id="menuOverlay" aria-hidden="true">
    <div id="menuBox" role="dialog" aria-modal="true">
      <h2>PICK YOUR DESTINATION</h2>
      <a class="menu-feature" href="#" id="goCali">CALI-CHALLENGE GENERATOR</a>
      <button id="menuClose" class="menu-close">Close / Esc</button>
    </div>
  </div>
  <div id="menuCloseMini" style="display:none;position:fixed;left:18px;bottom:18px;color:#fff;cursor:pointer;z-index:110">CLOSE / ESC</div>

  <!-- settings side panel -->
  <aside id="settingsPanel" aria-hidden="true">
    <h3>Settings</h3>
    <div class="setting-item" id="openThemes">Themes</div>
    <div style="height:6px"></div>
    <div class="settings-footer" id="closeSettings">Close / Esc</div>
  </aside>

  <!-- themes modal -->
  <div id="themesModalOverlay" aria-hidden="true">
    <div id="themesModal" role="dialog" aria-modal="true" aria-labelledby="themesTitle">
      <div id="themesModalHeader">
        <h3 id="themesTitle">Themes</h3>
      </div>

      <div id="themesGrid"></div>

      <button id="themesCloseBtn">Close / Esc</button>
    </div>
  </div>

  <!-- settings / themes side panels (old style stack) -->
  <aside id="settingsPanelStack" class="panel" style="display:none;"></aside>
  <aside id="themesPanel" style="display:none;"></aside>
  <aside id="createPanel" style="display:none;"></aside>

  <!-- Generator UI Overlays -->
  <!-- Intro -->
  <div id="genIntroOverlay" class="gen-overlay" aria-hidden="true">
    <div class="gen-box" role="dialog" aria-modal="true">
      <div class="gen-header">We need to ask a few things before you generate</div>
      <div class="gen-sub">Answer two short questions and we'll drop one challenge for you.</div>
      <div class="gen-actions">
        <button id="genIntroBack" class="back-small">Back</button>
        <button id="genIntroProceed" class="next-primary">Proceed</button>
      </div>
    </div>
  </div>

  <!-- Type -->
  <div id="genTypeOverlay" class="gen-overlay" aria-hidden="true">
    <div class="gen-box" role="dialog" aria-modal="true">
      <div class="gen-header">Select Challenge Type</div>
      <div class="option-grid" id="genTypeGrid">
        <button class="option-btn" data-type="push">Push</button>
        <button class="option-btn" data-type="pull">Pull</button>
        <button class="option-btn" data-type="core">Core</button>
        <button class="option-btn" data-type="legs">Legs</button>
        <button class="option-btn" data-type="cardio">Cardio</button>
        <button class="option-btn" data-type="statics">Statics</button>
      </div>
      <div class="gen-actions">
        <button id="genTypeBack" class="back-small">Back</button>
      </div>
    </div>
  </div>

  <!-- Level -->
  <div id="genLevelOverlay" class="gen-overlay" aria-hidden="true">
    <div class="gen-box" role="dialog" aria-modal="true">
      <div class="gen-header">Select Your Level</div>
      <div class="option-grid" id="genLevelGrid">
        <button class="option-btn" data-level="beginner">Beginner</button>
        <button class="option-btn" data-level="above-beginner">Above Beginner</button>
        <button class="option-btn" data-level="intermediate">Intermediate</button>
        <button class="option-btn" data-level="above-intermediate">Above Intermediate</button>
        <button class="option-btn" data-level="advanced">Advanced</button>
      </div>
      <div class="gen-actions">
        <button id="genLevelBack" class="back-small">Back</button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div id="genLoadingOverlay" class="gen-overlay" aria-hidden="true">
    <div class="gen-box">
      <div class="gen-loading">
        <div class="spinner" aria-hidden="true"></div>
        <div class="gen-sub">⚡ Generating your challenge...</div>
      </div>
    </div>
  </div>

  <!-- Challenge -->
  <div id="genChallengeOverlay" class="gen-overlay" aria-hidden="true">
    <div class="gen-box" role="dialog" aria-modal="true">
      <div class="gen-header">Your Challenge</div>
      <div class="gen-challenge" id="genChallengeBox">
        <h3 id="genChallengeTitle">Challenge</h3>
        <p id="genChallengeText">Do the thing...</p>
      </div>
      <div class="gen-actions">
        <button id="genChallengeBack" class="back-small">Back</button>
        <button id="genCompleteBtn" class="next-primary">Complete</button>
      </div>
    </div>
  </div>

  <!-- Completed card -->
  <div id="genCompleteOverlay" class="gen-overlay" aria-hidden="true">
    <div class="gen-complete-card" role="dialog" aria-modal="true">
      <div class="card-title">STHALOS</div>
      <div class="card-image" id="cardImageArea">Great job!</div>
      <div class="card-details" id="completedChallengeDetails">You finished: ...</div>
      <div class="card-meta" id="completedMeta">Time taken: --</div>
      <div class="gen-watermark">@harsh.not.found</div>

      <div class="gen-complete-actions">
        <button id="genAgainBtn" class="gen-btn primary">Generate Again</button>
        <button id="genCloseBtn" class="gen-btn light">Close</button>
      </div>

      <div class="share-btn" id="shareBtn" title="Share"><i class="fas fa-share-alt"></i></div>
    </div>
  </div>

<script>
/* ==========================
   Themes / Settings / UI
   ========================== */

/* Built-in themes (25) — same as you had */
const themeList = [
  { id:'theme-01', name:'Dark Crimson', colors:['#1a0033','#000033','#330000','#220033'], desc:'Deep red and midnight', accent:'#ff1a1a' },
  { id:'theme-02', name:'Blueberry Blues', colors:['#0d1b2a','#1b263b','#415a77','#1b1f4f'], desc:'Cold indigos and deep sea', accent:'#ffd9e0' },
  { id:'theme-03', name:'Tropical Sunset', colors:['#ff7e5f','#feb47b','#f6d365','#fda085'], desc:'Warm orange and gold', accent:'#07104b' },
  { id:'theme-04', name:'Candy Lagoon', colors:['#ff66b2','#ffffff','#00ffff','#ff99cc'], desc:'Playful pastels and cyan', accent:'#07104b' },
  { id:'theme-05', name:'Cosmic Night', colors:['#0f0c29','#302b63','#24243e','#4b2b7f'], desc:'Deep space indigo', accent:'#ffb6c6' },
  { id:'theme-06', name:'Forest Whisper', colors:['#0b3d20','#1f5f2a','#3b8d47','#0f2f1a'], desc:'Greens like moss and pine', accent:'#ffdca3' },
  { id:'theme-07', name:'Inferno Blaze', colors:['#2b0000','#ff3b00','#ff8b00','#662200'], desc:'Fiery red-orange', accent:'#fff1e6' },
  { id:'theme-08', name:'Crystal Sky', colors:['#0066cc','#66ccff','#aaf0ff','#1a9cff'], desc:'Ocean blues and aqua', accent:'#001a3d' },
  { id:'theme-09', name:'Sakura Dream', colors:['#ffb3c6','#ffdfe6','#fff0f8','#ffb3d9'], desc:'Soft pink cherry tones', accent:'#07104b' },
  { id:'theme-10', name:'Neon Storm', colors:['#00ffff','#ff00ff','#00ff88','#001a33'], desc:'Electric bright neons', accent:'#ffffff' },
  { id:'theme-11', name:'Desert Mirage', colors:['#ef9a3c','#f4d06f','#c67f33','#e9c46a'], desc:'Warm sand and gold', accent:'#07104b' },
  { id:'theme-12', name:'Glacier Mist', colors:['#eaf6ff','#bfe9ff','#8fd6ff','#cfeeff'], desc:'Cool icy blues', accent:'#001a3d' },
  { id:'theme-13', name:'Royal Gold', colors:['#f7d794','#f6caa3','#f0b67f','#f2a65a'], desc:'Regal gold tones', accent:'#07104b' },
  { id:'theme-14', name:'Ocean Deep', colors:['#001f3f','#003f5c','#2f4b7c','#665191'], desc:'Dark navy sea depth', accent:'#a8e6ff' },
  { id:'theme-15', name:'Ember Glow', colors:['#ff4e50','#f9d423','#ff7b00','#ff3b3b'], desc:'Warm ember and gold', accent:'#0b0b0b' },
  { id:'theme-16', name:'Meadow Fresh', colors:['#76b852','#8dc26f','#b7e4a5','#4a8f29'], desc:'Lively green pastures', accent:'#05311a' },
  { id:'theme-17', name:'Twilight Purple', colors:['#2c3e50','#4ca1af','#7b2ff7','#b983ff'], desc:'Dusky purple twilight', accent:'#fff6f6' },
  { id:'theme-18', name:'Copper Canyon', colors:['#7b3f00','#c86b2d','#ffaa5c','#3d1300'], desc:'Earthy copper and rust', accent:'#fff0e0' },
  { id:'theme-19', name:'Arctic Dawn', colors:['#cfe9ff','#a6e1ff','#7bd3ff','#e6fbff'], desc:'Pale sky and cool tones', accent:'#012a4a' },
  { id:'theme-20', name:'Rosewood', colors:['#2b0a3d','#72306a','#a93f86','#ff6b9f'], desc:'Deep rose and mauve', accent:'#fff6f6' },
  { id:'theme-21', name:'Mango Tango', colors:['#ffb347','#ffcc33','#ff7f50','#ffcc66'], desc:'Tropical mango gold', accent:'#041a2b' },
  { id:'theme-22', name:'Indigo Dusk', colors:['#2b5876','#4e4376','#6c5b7b','#8a65a7'], desc:'Soft indigo dusk blues', accent:'#fff7ff' },
  { id:'theme-23', name:'Mint Whisper', colors:['#d4fc79','#96e6a1','#b8ffcc','#6dd3b0'], desc:'Fresh minty palette', accent:'#012a1a' },
  { id:'theme-24', name:'Solar Flare', colors:['#f7971e','#ffd200','#ff4e50','#ff7b00'], desc:'Bright sunburst gradient', accent:'#07104b' },
  { id:'theme-25', name:'Lunar Grey', colors:['#3a3a3a','#6b6b6b','#a3a3a3','#dddddd'], desc:'Monochrome steel & moon', accent:'#041430' }
];

const paletteColors = [
  '#0b3d20','#1f8a70','#3ad59f','#ffd166','#ff6b6b','#ffbf69','#ff9a8b','#c34a36',
  '#6a4c93','#2b2d42','#1b998b','#8ecae6','#ffb4a2','#ff7b7b','#f72585','#7209b7',
  '#0ea5a4','#06b6d4','#e0aaff','#8ec5ff'
];

const STORAGE_CUSTOM_LIST = 'sthalos_custom_list';
let themes = [];

// load and merge themes
function loadThemesFromStorage(){
  themes = [...themeList];
  try {
    const stored = localStorage.getItem(STORAGE_CUSTOM_LIST);
    if (stored) {
      const arr = JSON.parse(stored);
      if (Array.isArray(arr)) {
        arr.forEach((t,i) => {
          if (!t.id) t.id = 'custom-'+i+'-'+Date.now();
          themes.push(t);
        });
      }
    }
  } catch(e){ console.warn('bad custom themes',e); }
}
loadThemesFromStorage();

// helper
function gradientFrom(colors){
  return 'linear-gradient(135deg, ' + colors.join(',') + ')';
}
function applyTheme(theme){
  if(!theme || !theme.colors) return;
  document.body.style.background = gradientFrom(theme.colors);
  document.body.style.backgroundSize = '400% 400%';
  document.body.style.animation = 'gradientShift 12s ease infinite';
  if(theme.accent) document.documentElement.style.setProperty('--accent', theme.accent);
  // store
  try { localStorage.setItem('sthalos_theme', theme.id); } catch(e){}
}
(function restore(){
  try {
    const id = localStorage.getItem('sthalos_theme');
    if (id) {
      const t = themeList.find(x => x.id === id);
      if (t) applyTheme(t);
    }
  } catch(e){}
})();

/* Themes modal rendering */
const themesModalOverlay = document.getElementById('themesModalOverlay');
const themesGrid = document.getElementById('themesGrid');
const themesCloseBtn = document.getElementById('themesCloseBtn');

function renderThemesGrid(){
  themesGrid.innerHTML = '';
  themes.forEach(t => {
    const card = document.createElement('div');
    card.className = 'theme-card';
    card.tabIndex = 0;
    const dot = document.createElement('div');
    dot.className = 'theme-dot';
    dot.style.background = gradientFrom(t.colors);
    const info = document.createElement('div');
    const name = document.createElement('div'); name.className = 'theme-name'; name.innerText = t.name;
    const desc = document.createElement('div'); desc.className = 'theme-desc'; desc.innerText = t.desc || '';
    info.appendChild(name); info.appendChild(desc);
    card.appendChild(dot); card.appendChild(info);
    card.addEventListener('click', ()=> applyTheme(t));
    card.addEventListener('keydown', (e)=> { if(e.key==='Enter') applyTheme(t); });
    themesGrid.appendChild(card);
  });
}

/* UI wiring for themes/settings */
document.getElementById('openThemes').addEventListener('click', ()=>{
  loadThemesFromStorage(); renderThemesGrid();
  themesModalOverlay.style.display = 'flex';
});
themesCloseBtn.addEventListener('click', ()=> { themesModalOverlay.style.display = 'none'; });
themesModalOverlay.addEventListener('click', (e)=> { if(e.target===themesModalOverlay) themesModalOverlay.style.display='none'; });

document.getElementById('settingsBtn').addEventListener('click', ()=>{
  document.getElementById('settingsPanel').classList.toggle('open');
  document.getElementById('settingsBtn').classList.toggle('rotate');
});
document.getElementById('closeSettings').addEventListener('click', ()=>{
  document.getElementById('settingsPanel').classList.remove('open');
  document.getElementById('settingsBtn').classList.remove('rotate');
});

/* Basic menu open/close */
const enterBtn = document.getElementById('enterBtn');
const menuOverlay = document.getElementById('menuOverlay');
const menuCloseBtn = document.getElementById('menuClose');

enterBtn.addEventListener('click', ()=>{
  menuOverlay.style.display = 'flex';
  setTimeout(()=> menuOverlay.classList.add('show'), 30);
});
menuCloseBtn.addEventListener('click', ()=>{
  menuOverlay.classList.remove('show');
  setTimeout(()=> menuOverlay.style.display='none', 320);
});

/* Quote */
const quotes = [
  "\"Strength does not come from winning.\"",
  "\"Fall seven times and stand up eight.\"",
  "\"The body achieves what the mind believes.\"",
  "\"Push yourself, because no one else will.\"",
  "\"Discipline beats motivation.\"",
  "\"Suffer the pain of discipline or regret.\"",
  "\"No pain, no gain.\"",
  "\"You are stronger than you think.\"",
  "\"Consistency is key.\"",
  "\"Calisthenics builds warriors.\""
];
document.getElementById('quote').innerText = quotes[Math.floor(Math.random()*quotes.length)];

/* ==========================
   Generator module (single, consolidated)
   ========================== */
(function(){
  // Elements
  const goCali = document.getElementById('goCali') || document.getElementById('featureCali') || null;
  const menuOverlayEl = document.getElementById('menuOverlay');
  const menuCloseMini = document.getElementById('menuCloseMini');

  const genIntro = document.getElementById('genIntroOverlay');
  const genType = document.getElementById('genTypeOverlay');
  const genLevel = document.getElementById('genLevelOverlay');
  const genLoading = document.getElementById('genLoadingOverlay');
  const genChallenge = document.getElementById('genChallengeOverlay');
  const genComplete = document.getElementById('genCompleteOverlay');

  const genIntroProceed = document.getElementById('genIntroProceed');
  const genIntroBack = document.getElementById('genIntroBack');
  const genTypeBack = document.getElementById('genTypeBack');
  const genLevelBack = document.getElementById('genLevelBack');

  const genTypeGrid = document.getElementById('genTypeGrid');
  const genLevelGrid = document.getElementById('genLevelGrid');

  const genChallengeTitle = document.getElementById('genChallengeTitle');
  const genChallengeText = document.getElementById('genChallengeText');
  const genChallengeBack = document.getElementById('genChallengeBack');
  const genCompleteBtn = document.getElementById('genCompleteBtn');

  const genAgainBtn = document.getElementById('genAgainBtn');
  const genCloseBtn = document.getElementById('genCloseBtn');

  const completedDetails = document.getElementById('completedChallengeDetails');
  const completedMeta = document.getElementById('completedMeta');
  const cardImageArea = document.getElementById('cardImageArea');
  const shareBtn = document.getElementById('shareBtn');

  // Sample dataset: 50 push beginner challenges (kept as-is)
  const pushBeginner = [
    "Do 10 knee pushups in one go.",
    "Hold a regular pushup position for 20 seconds.",
    "Perform 8 incline pushups on a bench.",
    "Do 12 wall pushups without resting.",
    "Try 5 regular pushups slow motion (4s down, 4s up).",
    "Do 15 knee pushups, pause for 5s halfway down.",
    "Complete 10 incline pushups clapping at the top.",
    "Hold a plank-to-pushup position for 25 seconds.",
    "Do 6 negative pushups (slow on the way down).",
    "Do 10 wall pushups with a single leg lifted.",
    "Try 5 regular pushups with shoulder taps each rep.",
    "Do 20 wall pushups nonstop.",
    "Perform 10 knee pushups with a 3s hold at the bottom.",
    "Hold an incline pushup halfway down for 15 seconds.",
    "Do 5 regular pushups on fists.",
    "Complete 10 incline pushups with wide hand placement.",
    "Do 8 pushups pausing 1s at top and bottom.",
    "Perform 12 wall pushups twisting torso each side.",
    "Hold a downward pushup hold for 10 seconds.",
    "Do 6 pushups on knees with hands close together.",
    "Do 15 incline pushups with shoulders over wrists.",
    "Perform 10 pushups tapping chest with one hand at top.",
    "Hold a wall pushup halfway for 20 seconds.",
    "Do 12 pushups lifting one leg alternately.",
    "Perform 5 slow negatives then push back up on knees.",
    "Do 10 knee pushups with knees slightly off the floor.",
    "Do 8 pushups moving hands forward each rep.",
    "Complete 15 wall pushups at a fast pace.",
    "Hold a pushup top position for 30 seconds.",
    "Do 5 pushups, pausing 3 times on the way down.",
    "Try 10 incline pushups, protracting shoulders at the top.",
    "Do 12 wall pushups leaning extra forward.",
    "Perform 8 pushups with a 2s pause on elbows bent.",
    "Do 5 knee pushups then 5 regular pushups.",
    "Do 10 pushups with hands rotated outward.",
    "Hold an incline pushup bottom for 12 seconds.",
    "Perform 6 pushups slow eccentric (6s lowering).",
    "Do 15 wall pushups with eyes closed.",
    "Try 10 pushups tapping shoulders at the top each time.",
    "Do 5 incline pushups, clap hands each rep.",
    "Hold a pushup at 90° arms for 15 seconds.",
    "Perform 12 knee pushups with a narrow (diamond-ish) hand position.",
    "Do 10 wall pushups explosive (push away from the wall).",
    "Do 8 incline pushups feet together, strict form.",
    "Hold a pushup at the top while shifting shoulders forward-back for 20 seconds.",
    "Perform 6 pushups lifting one hand at the bottom each rep.",
    "Do 10 pushups with a 3s hold halfway through each rep.",
    "Complete 15 incline pushups with elbows tucked.",
    "Do 8 knee pushups plus a 10s plank hold.",
    "Hold pushup bottom position for 20 seconds without collapsing."
  ];

  // state
  let selectedType = null;
  let selectedLevel = null;
  let lastPicked = null;
  let generationStartMs = null;

  // overlay helpers (centralized)
  function showOverlay(el){
    if(!el) return;
    el.style.display = 'flex';
    // ensure animations can run
    setTimeout(()=> el.classList.add('show'), 20);
    document.body.classList.add('gen-active');
  }
  function hideOverlay(el){
    if(!el) return;
    el.classList.remove('show');
    setTimeout(()=> { el.style.display = 'none'; }, 260);
    // if no other overlay is visible, clear gen-active:
    setTimeout(()=> {
      const any = document.querySelectorAll('.gen-overlay.show');
      if(!any.length) document.body.classList.remove('gen-active');
    }, 300);
  }

  // Flow: open generator from menu
  if (goCali) {
    goCali.addEventListener('click', (ev)=>{
      ev.preventDefault();
      // close menu
      menuOverlayEl.classList.remove('show');
      setTimeout(()=> { menuOverlayEl.style.display='none'; }, 300);
      // reset state
      selectedType = null; selectedLevel = null; lastPicked = null; generationStartMs = null;
      // clear UI selections
      genTypeGrid.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
      genLevelGrid.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
      showOverlay(genIntro);
    });
  }

  // Intro controls
  genIntroProceed.addEventListener('click', ()=>{
    hideOverlay(genIntro);
    showOverlay(genType);
  });
  genIntroBack.addEventListener('click', ()=>{
    hideOverlay(genIntro);
    // reopen menu
    menuOverlayEl.style.display='flex';
    setTimeout(()=> menuOverlayEl.classList.add('show'), 30);
  });

  // Type selection
  genTypeGrid.querySelectorAll('.option-btn').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      genTypeGrid.querySelectorAll('.option-btn').forEach(x=>x.classList.remove('selected'));
      btn.classList.add('selected');
      selectedType = btn.dataset.type;
      hideOverlay(genType);
      setTimeout(()=> showOverlay(genLevel), 140);
    });
  });
  genTypeBack.addEventListener('click', ()=>{
    hideOverlay(genType);
    showOverlay(genIntro);
  });

  // Level selection
  genLevelGrid.querySelectorAll('.option-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      genLevelGrid.querySelectorAll('.option-btn').forEach(x=>x.classList.remove('selected'));
      btn.classList.add('selected');
      selectedLevel = btn.dataset.level;
      hideOverlay(genLevel);
      // start generation
      startGeneration();
    });
  });
  genLevelBack.addEventListener('click', ()=>{
    hideOverlay(genLevel);
    showOverlay(genType);
  });

  // Challenge back
  genChallengeBack.addEventListener('click', ()=>{
    hideOverlay(genChallenge);
    showOverlay(genLevel);
  });

  // Complete flow: user indicates they finished challenge (stop timer)
  genCompleteBtn.addEventListener('click', ()=>{
    if(!lastPicked) return;
    // stop timer
    let timeTakenText = '--';
    if (generationStartMs) {
      const elapsed = Date.now() - generationStartMs;
      timeTakenText = formatMs(elapsed);
    }
    hideOverlay(genChallenge);
    showCompleteCard(lastPicked, timeTakenText);
  });

  // Generate again (re-roll same settings)
  genAgainBtn.addEventListener('click', ()=>{
    hideOverlay(genComplete);
    // re-run generation with same type/level
    startGeneration();
  });

  // Close complete -> return to menu
  genCloseBtn.addEventListener('click', ()=>{
    hideOverlay(genComplete);
    // reopen main menu
    menuOverlayEl.style.display='flex';
    setTimeout(()=> menuOverlayEl.classList.add('show'), 30);
  });

  // share button on complete card
  shareBtn && shareBtn.addEventListener('click', async ()=>{
    const challengeText = completedDetails.innerText || '';
    const meta = completedMeta.innerText || '';
    const shareData = { title: 'Sthalos Challenge', text: challengeText + '\\n' + meta, url: window.location.href };
    if (navigator.share) {
      try { await navigator.share(shareData); } catch(e) { console.warn('share failed',e); }
    } else {
      // fallback: copy to clipboard
      try {
        await navigator.clipboard.writeText(shareData.text + '\\n' + shareData.url);
        alert('Challenge details copied to clipboard.');
      } catch(e) {
        prompt('Copy this challenge text:', shareData.text + '\\n' + shareData.url);
      }
    }
  });

  // utility: format ms => mm:ss or s
  function formatMs(ms){
    if (!ms && ms !== 0) return '--';
    const s = Math.round(ms/1000);
    if (s < 60) return s + 's';
    const m = Math.floor(s/60);
    const rem = s % 60;
    return m + 'm ' + rem + 's';
  }

  // showCompleteCard: populate and display completion overlay
  function showCompleteCard(challengeText, timeTaken){
    // random appreciation message in the image area
    const appreciation = [
      'Nice work. Keep pushing.',
      'Solid grind. Respect.',
      'One step closer.',
      'You just leveled up.',
      'That\'s how champions are made.'
    ];
    const msg = appreciation[Math.floor(Math.random()*appreciation.length)];
    if (cardImageArea) cardImageArea.innerText = msg;

    completedDetails.innerText = 'You finished: ' + challengeText;
    completedMeta.innerText = 'Time taken: ' + timeTaken;
    showOverlay(genComplete);

    // store last result in localStorage history? (future)
  }

  // main generator: selects a challenge string
  function generateChallenge(type, level){
    // only implemented: push + beginner (for now)
    if (type === 'push' && level === 'beginner') {
      return pushBeginner[Math.floor(Math.random()*pushBeginner.length)];
    }
    // otherwise fallback placeholder
    return `This ${type} / ${level} combo not implemented yet — try Push → Beginner.`;
  }

  // startGeneration controls loading + showing challenge + start timer
  function startGeneration(){
    showOverlay(genLoading);
    // small artificial delay to feel real
    setTimeout(()=>{
      hideOverlay(genLoading);
      // pick
      const picked = generateChallenge(selectedType, selectedLevel);
      lastPicked = picked;
      // populate
      genChallengeTitle.innerText = (selectedType ? selectedType.toUpperCase() : 'CHALLENGE') + ' — ' + (selectedLevel ? selectedLevel.replace('-', ' ') : '');
      genChallengeText.innerText = picked;
      // start timer
      generationStartMs = Date.now();
      showOverlay(genChallenge);
    }, 800);
  }

  // ESC keyboard handling: close topmost overlay or go back
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' || e.key === 'Esc') {
      // priority: complete -> challenge -> level -> type -> intro -> menu
      if (genComplete.classList.contains('show')) { hideOverlay(genComplete); return; }
      if (genChallenge.classList.contains('show')) { hideOverlay(genChallenge); showOverlay(genLevel); return; }
      if (genLevel.classList.contains('show')) { hideOverlay(genLevel); showOverlay(genType); return; }
      if (genType.classList.contains('show')) { hideOverlay(genType); showOverlay(genIntro); return; }
      if (genIntro.classList.contains('show')) { hideOverlay(genIntro); menuOverlayEl.style.display='flex'; setTimeout(()=> menuOverlayEl.classList.add('show'),30); return; }
      // otherwise close menu if open
      if (menuOverlayEl.classList.contains('show')) { menuOverlayEl.classList.remove('show'); setTimeout(()=> menuOverlayEl.style.display='none',320); return; }
    }
  });

  // clicking outside of the gen-box steps back instead of closing outright
  [genIntro, genType, genLevel, genLoading, genChallenge, genComplete].forEach(overlay => {
    if (!overlay) return;
    overlay.addEventListener('click', (e)=>{
      if (e.target !== overlay) return;
      // overlay clicked
      if (overlay === genChallenge) { hideOverlay(genChallenge); showOverlay(genLevel); return; }
      if (overlay === genLevel) { hideOverlay(genLevel); showOverlay(genType); return; }
      if (overlay === genType) { hideOverlay(genType); showOverlay(genIntro); return; }
      if (overlay === genIntro) { hideOverlay(genIntro); menuOverlayEl.style.display='flex'; setTimeout(()=>menuOverlayEl.classList.add('show'),30); return; }
      hideOverlay(overlay);
    });
  });

})(); // end generator module

/* End of file */
</script>

</body>
</html>
